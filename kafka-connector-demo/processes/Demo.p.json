{
  "$schema" : "https://json-schema.axonivy.com/process/12.0.0/process.json",
  "id" : "18833AFFFC2AC1DD",
  "config" : {
    "data" : "com.axonivy.connector.kafka.demo.DemoData"
  },
  "elements" : [ {
      "id" : "f0",
      "type" : "RequestStart",
      "name" : "start.ivp",
      "config" : {
        "signature" : "start",
        "request" : {
          "name" : "Send Kafka messages",
          "description" : "Send Kafka messages for different topics in a simple GUI."
        }
      },
      "tags" : [
        "demo"
      ],
      "visual" : {
        "at" : { "x" : 96, "y" : 80 }
      },
      "connect" : [
        { "id" : "f21", "to" : "f19" }
      ]
    }, {
      "id" : "f1",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 416, "y" : 80 }
      }
    }, {
      "id" : "f5",
      "type" : "ProgramStart",
      "name" : "TopicA",
      "config" : {
        "javaClass" : "com.axonivy.connector.kafka.KafkaStartEventBean",
        "userConfig" : {
          "topicPatternField" : "TopicA",
          "kafkaConfigurationNameField" : "localhost",
          "synchronousField" : "false"
        },
        "link" : "eventLink.ivp"
      },
      "visual" : {
        "at" : { "x" : 96, "y" : 336 },
        "labelOffset" : { "x" : 13, "y" : 33 },
        "icon" : "res:/webContent/icons/logo.png?small"
      },
      "connect" : [
        { "id" : "f9", "to" : "f8" }
      ]
    }, {
      "id" : "f8",
      "type" : "Script",
      "name" : "Log",
      "config" : {
        "output" : {
          "code" : [
            "ivy.log.info(\"Received Kafka message, topic ''{0}'', offset: {1}, key: ''{2}'', value: ''{3}''.\",",
            "  in.consumerRecord.topic(),",
            "  in.consumerRecord.offset(),",
            "  in.consumerRecord.key(),",
            "  in.consumerRecord.value());"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 240, "y" : 416 }
      },
      "connect" : [
        { "id" : "f12", "to" : "f11" }
      ]
    }, {
      "id" : "f11",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 416, "y" : 416 }
      }
    }, {
      "id" : "f13",
      "type" : "Script",
      "name" : "Consume and commit message.",
      "config" : {
        "output" : {
          "code" : [
            "import ch.ivyteam.ivy.process.model.value.SignalCode;",
            "ivy.wf.signals().create().data(in.consumerRecord.value()).makeCurrentTaskPersistent().send(SignalCode.of(\"signalCode\"));",
            "",
            "// After successful handling, message can be committed. If the message is not",
            "// committed, it will be retransferred after the next restart of the client.",
            "// Please see the documentation of Kafka for details.",
            "in.consumer.commitSync();"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 240, "y" : 576 }
      },
      "connect" : [
        { "id" : "f16", "to" : "f15" }
      ]
    }, {
      "id" : "f15",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 416, "y" : 576 }
      }
    }, {
      "id" : "f17",
      "type" : "ProcessAnnotation",
      "name" : [
        "Asynchronous message handling. Messages of a topic can be received while others are still beeing processed in a worker pool.",
        "Message processing will end (but not block receiving new messages for the topic) at a process end element or at a task switch element."
      ],
      "visual" : {
        "at" : { "x" : 648, "y" : 416 },
        "size" : { "width" : 376, "height" : 80 }
      }
    }, {
      "id" : "f18",
      "type" : "ProcessAnnotation",
      "name" : [
        "Synchronous message handling. Only a single message of a topic will be processed. The worker pool will not be used. If you want to commit messages yourself (not automatically as in the default), then you should go this way.",
        "Message processing will end (and the next message of the topic can be received) at a process end element or at a task switch element."
      ],
      "visual" : {
        "at" : { "x" : 646, "y" : 577 },
        "size" : { "width" : 369, "height" : 116 }
      }
    }, {
      "id" : "f19",
      "type" : "DialogCall",
      "name" : "Demo GUI",
      "config" : {
        "dialog" : "com.axonivy.connector.kafka.demo.DemoGui:start()"
      },
      "visual" : {
        "at" : { "x" : 240, "y" : 80 }
      },
      "connect" : [
        { "id" : "f2", "to" : "f1" }
      ]
    }, {
      "id" : "f3",
      "type" : "SignalStartEvent",
      "name" : "kafka:connector:demo:signal",
      "config" : {
        "signalCode" : "kafka:connector:demo:signal",
        "output" : {
          "map" : {
            "out.signalData" : "signal.getSignalData() as String"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 96, "y" : 192 },
        "labelOffset" : { "x" : 41, "y" : 49 }
      },
      "connect" : [
        { "id" : "f20", "to" : "f4" }
      ]
    }, {
      "id" : "f4",
      "type" : "Script",
      "name" : "Log",
      "config" : {
        "output" : {
          "code" : "ivy.log.info(\"Received signal for finished sending: {0}\", in.signalData);"
        }
      },
      "visual" : {
        "at" : { "x" : 240, "y" : 192 }
      },
      "connect" : [
        { "id" : "f23", "to" : "f22" }
      ]
    }, {
      "id" : "f22",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 416, "y" : 192 },
        "labelOffset" : { "x" : 13, "y" : 33 }
      }
    }, {
      "id" : "f24",
      "type" : "ProcessAnnotation",
      "name" : "Signal handler for signals sent by the send callback of Topic S. Whenever a message was sent to TopicS, this signal will be called.",
      "visual" : {
        "at" : { "x" : 649, "y" : 201 },
        "size" : { "width" : 366, "height" : 78 }
      }
    }, {
      "id" : "f6",
      "type" : "ProgramStart",
      "name" : "TopicB",
      "config" : {
        "javaClass" : "com.axonivy.connector.kafka.KafkaStartEventBean",
        "userConfig" : {
          "topicPatternField" : "TopicB",
          "kafkaConfigurationNameField" : "localhost",
          "synchronousField" : "false"
        },
        "link" : "eventLink2.ivp"
      },
      "visual" : {
        "at" : { "x" : 96, "y" : 416 },
        "labelOffset" : { "x" : 13, "y" : 33 },
        "icon" : "res:/webContent/icons/logo.png?small"
      },
      "connect" : [
        { "id" : "f7", "to" : "f8" }
      ]
    }, {
      "id" : "f10",
      "type" : "ProgramStart",
      "name" : "TopicS",
      "config" : {
        "javaClass" : "com.axonivy.connector.kafka.KafkaStartEventBean",
        "userConfig" : {
          "topicPatternField" : "TopicS",
          "kafkaConfigurationNameField" : "localhost",
          "synchronousField" : "true"
        },
        "link" : "eventLink3.ivp"
      },
      "visual" : {
        "at" : { "x" : 96, "y" : 576 },
        "labelOffset" : { "x" : 13, "y" : 33 },
        "icon" : "res:/webContent/icons/logo.png?small"
      },
      "connect" : [
        { "id" : "f14", "to" : "f13" }
      ]
    }, {
      "id" : "f25",
      "type" : "ProgramStart",
      "name" : "PersonTopic",
      "config" : {
        "javaClass" : "com.axonivy.connector.kafka.KafkaStartEventBean",
        "userConfig" : {
          "topicPatternField" : "PersonTopic",
          "kafkaConfigurationNameField" : "localhostSchematic",
          "synchronousField" : "true"
        },
        "link" : "eventLink4.ivp"
      },
      "visual" : {
        "at" : { "x" : 96, "y" : 720 },
        "labelOffset" : { "x" : 13, "y" : 33 },
        "icon" : "res:/webContent/icons/logo.png?small"
      },
      "connect" : [
        { "id" : "f26", "to" : "f27" }
      ]
    }, {
      "id" : "f27",
      "type" : "Script",
      "name" : "Log",
      "config" : {
        "output" : {
          "code" : [
            "ivy.log.info(\"Received Kafka message, topic ''{0}'', offset: {1}, key: ''{2}'', type: ''{3}'' value: ''{4}''.\",",
            "  in.consumerRecord.topic(),",
            "  in.consumerRecord.offset(),",
            "  in.consumerRecord.key(),",
            "  in.consumerRecord.value().getClass(),",
            "  in.consumerRecord.value());"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 240, "y" : 720 }
      },
      "connect" : [
        { "id" : "f29", "to" : "f28" }
      ]
    }, {
      "id" : "f28",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 416, "y" : 720 },
        "labelOffset" : { "x" : 13, "y" : 33 }
      }
    }, {
      "id" : "f30",
      "type" : "ProcessAnnotation",
      "name" : "Receiving complex objects instead of strings.",
      "visual" : {
        "at" : { "x" : 648, "y" : 720 },
        "size" : { "width" : 372, "height" : 32 }
      }
    } ],
  "layout" : {
    "lanes" : [ {
        "name" : "Demo",
        "offset" : 32,
        "size" : 768,
        "lanes" : [ {
            "name" : "Sending",
            "size" : 240,
            "color" : "Sending"
          }, {
            "name" : "Receiving",
            "size" : 528,
            "color" : "Receiving"
          } ]
      } ],
    "colors" : {
      "Sending" : "#ccffde",
      "Receiving" : "#ffe7a3"
    }
  }
}